---
id: motion_activated_security_light
alias: Motion Activated Security Light
description: Turn on security lights when motion detected at night, with adaptive brightness
mode: restart  # Restart timer if motion detected again
trigger:
  - platform: state
    entity_id: binary_sensor.front_yard_motion
    to: 'on'
  - platform: state
    entity_id: binary_sensor.backyard_motion
    to: 'on'
  - platform: state
    entity_id: binary_sensor.driveway_motion
    to: 'on'
condition:
  - condition: or
    conditions:
      - condition: sun
        after: sunset
        after_offset: "-00:30:00"  # 30 min before sunset
      - condition: sun
        before: sunrise
        before_offset: "00:30:00"  # 30 min after sunrise
      - condition: numeric_state
        entity_id: sensor.outdoor_brightness
        below: 100  # lux
action:
  - service: light.turn_on
    target:
      entity_id: "{{ trigger.entity_id.replace('binary_sensor.', 'light.').replace('_motion', '') }}"
    data:
      brightness_pct: >
        {% set hour = now().hour %}
        {% if hour >= 22 or hour < 6 %}
          40  # Dim during late night
        {% elif hour >= 20 or hour < 7 %}
          60  # Medium during evening/early morning
        {% else %}
          100  # Full brightness during dusk
        {% endif %}
      color_temp: 2700  # Warm white
  - delay:
      minutes: 5
  - service: light.turn_off
    target:
      entity_id: "{{ trigger.entity_id.replace('binary_sensor.', 'light.').replace('_motion', '') }}"
